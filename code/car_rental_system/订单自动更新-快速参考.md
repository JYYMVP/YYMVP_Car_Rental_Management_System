# 订单自动更新 - 快速参考

## 🚀 快速开始

### 执行命令
```bash
python manage.py update_expired_rentals
```

或双击: `自动更新订单.bat`

## 📋 功能说明

✅ 自动将过期的"进行中"订单更新为"已完成"  
✅ 自动将无进行中订单的"已租"车辆更新为"可用"

## ⏰ 更新规则

| 项目 | 条件 | 操作 |
|------|------|------|
| **订单** | 状态=进行中 且 结束日期 < 今天 | 改为"已完成" |
| **车辆** | 无进行中订单 | 从"已租"改为"可用" |

## 💡 重要提示

- ⚠️ 当天结束的订单**不会**被更新(允许当天归还)
- ⚠️ 车辆有多个订单时,需等所有订单完成才释放
- ✅ 可重复执行,不会重复更新

## 🧪 测试功能

```bash
python test_auto_update.py
```

## 📅 定时执行

### Windows
打开任务计划程序 → 创建基本任务 → 每天01:00执行

### Linux/Mac
```bash
crontab -e
# 添加: 0 1 * * * cd /path && python manage.py update_expired_rentals
```

## 📊 执行效果示例

```
发现 8 个过期订单
✓ 已成功更新 8 个订单状态为"已完成"
✓ 已成功更新 3 个车辆状态为"可用"
```

## 📁 相关文件

- `rentals/management/commands/update_expired_rentals.py` - 核心代码
- `test_auto_update.py` - 测试脚本
- `订单自动更新使用说明.md` - 详细文档
- `订单自动更新实现报告.md` - 实现报告

## ❓ 常见问题

**Q: 为什么当天的订单没更新?**  
A: 设计如此,允许客户当天归还车辆

**Q: 车辆为什么还是已租?**  
A: 该车辆还有其他进行中的订单

**Q: 可以手动执行吗?**  
A: 可以,随时运行命令即可
